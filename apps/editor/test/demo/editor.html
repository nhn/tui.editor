<!DOCTYPE html>
<html>
  <head lang="en">
    <meta charset="UTF-8" />
    <title>Demo</title>
  </head>
  <body>
    <div id="editor"></div>
    <!-- Editor -->
    <script type="module">
      import { Editor } from '/dist/index.js';
      import { Plugin } from 'prosemirror-state';

      function fooPlugin() {
        console.log('foo');
        return null;
      }

      function barPlugin(eventEmitter, options) {
        const { hljs } = options || {};

        function customWwPlugin() {
          console.log('## test wysiwyg plugin');
          console.log(arguments);
          return new Plugin({ key: 'ww' });
        }

        function customMdPlugin() {
          console.log('## test markdown plugin');
          console.log(arguments);
          return new Plugin({ key: 'md' });
        }

        function customNodeView() {
          console.log('## test nodeview');
          console.log(arguments);

          const dom = document.createElement('span');

          dom.innerHTML = 'nodeview';

          return { dom };
        }

        return {
          plugins: [
            {
              editorType: 'wysiwyg',
              plugin: (eventEmitter) => {
                return customWwPlugin(eventEmitter, hljs);
              },
            },
            {
              editorType: 'markdown',
              plugin: (eventEmitter) => {
                return customMdPlugin(eventEmitter, hljs);
              },
            },
          ],
          nodeViews: [
            {
              editorType: 'wysiwyg',
              nodeName: 'codeBlock',
              view: (node, view, getPos, eventEmitter, toDOMAdaptor) => {
                return customNodeView(node, view, getPos, eventEmitter, toDOMAdaptor, hljs);
              },
            },
          ],
        };
      }

      const convertors = {
        latex(node) {
          // const generator = new latexjs.HtmlGenerator({ hyphenate: false });
          // const { body } = latexjs.parse(node.literal, { generator }).htmlDocument();

          return [
            { type: 'openTag', tagName: 'div', outerNewLine: true },
            { type: 'html', content: 'daf' },
            { type: 'closeTag', tagName: 'div', outerNewLine: true },
          ];
        },
      };

      const editor = new Editor({
        el: document.querySelector('#editor'),
        previewStyle: 'vertical',
        height: '400px',
        initialEditType: 'markdown',
        useCommandShortcut: true,
        extendedAutolinks: true,
        frontMatter: true,
        customHTMLRenderer: convertors,
        plugins: [fooPlugin, barPlugin],
      });

      window.editor = editor;
    </script>
  </body>
</html>
